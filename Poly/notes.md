Surface Language
    
    Type Variables X,Y,Z
    Types          A,B    ::=  X | Î¹ | Aâ†’B | âˆ€X.B | â˜…
    Term Variables x,y,z
    Terms          L,M,N  ::=  x | Î»x:A.N | L M | Î›X.V | L[A]
    Values        V,W    ::=  x | Î»x:A.N | Î›X.V

Precision

    Constraint     C ::=  A âŠ‘ B
    Contraint Set  ğ’

    -------------
    | ğ’ âŠ¢ A âŠ‘ B |
    -------------

    X âŠ‘ Y âˆˆ ğ’
    ----------
    ğ’ âŠ¢ X âŠ‘ Y

    â˜… âŠ‘ Y âˆˆ ğ’
    ---------- (Y â‰  âˆ€Z.B)
    ğ’ âŠ¢ â˜… âŠ‘ Y
    
    ğ’, X âŠ‘ Y âŠ¢ A âŠ‘ B
    -----------------
    ğ’ âŠ¢ âˆ€X.A âŠ‘ âˆ€Y.B

    ğ’, â˜… âŠ‘ Y âŠ¢ A âŠ‘ B
    ------------------ (Y âˆˆ B)
    ğ’ âŠ¢ A âŠ‘ âˆ€Y.B

    ---------
    ğ’ âŠ¢ Î¹ âŠ‘ Î¹

    ğ’ âŠ¢ A âŠ‘ Aâ€²   ğ’ âŠ¢ B âŠ‘ Bâ€²
    ------------------------
    ğ’ âŠ¢ Aâ†’B âŠ‘ Aâ€²â†’Bâ€²

    ----------
    ğ’ âŠ¢ â˜… âŠ‘ Î¹

    ğ’ âŠ¢ â˜… âŠ‘ Aâ€²   ğ’ âŠ¢ â˜… âŠ‘ Bâ€²
    ------------------------
    ğ’ âŠ¢ â˜… âŠ‘ Aâ€²â†’Bâ€²

Consistency

    Constraint     C ::=  A ~ B
    Contraint Set  ğ’

    -------------
    | ğ’ âŠ¢ A ~ B |
    -------------

    X ~ Y âˆˆ ğ’
    ----------
    ğ’ âŠ¢ X ~ Y

    â˜… ~ Y âˆˆ ğ’
    ----------
    ğ’ âŠ¢ â˜… ~ Y

    X ~ â˜… âˆˆ ğ’
    ----------
    ğ’ âŠ¢ X ~ â˜…

    ğ’, X ~ Y âŠ¢ A ~ B
    ----------------- (X âˆ‰ ğ’, Y âˆ‰ ğ’)
    ğ’ âŠ¢ âˆ€X.A ~ âˆ€Y.B

    ğ’, â˜… ~ Y âŠ¢ A ~ B
    ----------------- (Y âˆ‰ ğ’, Y âˆˆ B)
    ğ’ âŠ¢ A ~ âˆ€Y.B

    ğ’, X ~ â˜… âŠ¢ A ~ B
    ----------------- (X âˆ‰ ğ’, X âˆˆ A)
    ğ’ âŠ¢ âˆ€X.A ~ B

    ---------
    ğ’ âŠ¢ Î¹ ~ Î¹

    ğ’ âŠ¢ A ~ Aâ€²   ğ’ âŠ¢ B ~ Bâ€²
    ------------------------
    ğ’ âŠ¢ Aâ†’B ~ Aâ€²â†’Bâ€²

    ----------
    ğ’ âŠ¢ â˜… ~ Î¹

    ----------
    ğ’ âŠ¢ Î¹ ~ â˜…

    ğ’ âŠ¢ â˜… ~ Aâ€²   ğ’ âŠ¢ â˜… ~ Bâ€²
    ------------------------
    ğ’ âŠ¢ â˜… ~ Aâ€²â†’Bâ€²

    ğ’ âŠ¢ A ~ â˜…   ğ’ âŠ¢ B ~ â˜…
    -----------------------
    ğ’ âŠ¢ Aâ†’B ~ â˜…

Type System

    Type Environments   Î“      ::=  âˆ… | Î“, x:A | Î“, X | Î“, Î±=A

    -------------
    | Î“ âŠ¢ M : A |
    -------------
	
    x:A âˆˆ Î“
    ----------
    Î“ âŠ¢ x : A

    Î“, x:A âŠ¢ N : B
    ------------------
    Î“ âŠ¢ Î»x:A.N : A â†’ B

    Î“ âŠ¢ L : A â†’ B    Î“ âŠ¢ M : Aâ€²   A ~ Aâ€²
    ------------------------------------
    Î“ âŠ¢ L M : B

    Î“ âŠ¢ L : â˜…   Î“ âŠ¢ M : A
    ----------------------
    Î“ âŠ¢ L M : â˜…

    Î“, X âŠ¢ V : B
    ---------------
    Î“ âŠ¢ Î›X.V : âˆ€X.B

    Î“ âŠ¢ L : âˆ€X.B    Î“ âŠ¢ A
    ----------------------
    Î“ âŠ¢ L[A] : B[A/X]

    Î“ âŠ¢ L : â˜…    Î“ âŠ¢ A
    -------------------
    Î“ âŠ¢ L[A] : â˜…


Polymorphic Cast Calculus

    Terms             ::= x | Î»x.N | L M | Î›X.V | L[Î±] | M!G | M?G
	                    | Î½Î±=A.M | Mâ†“Î± | Mâ†‘Î±
	Ground Types  G,H ::= Î¹ | â˜…â†’â˜…

Compilation of Casts

    ----------------
    | âŸ¨A â‡’ BâŸ© = Mâ€² |  (pre: A ~ B)
    ----------------
    
    âŸ¨G â‡’ â˜…âŸ© = (Î»x. x!G)
    âŸ¨â˜… â‡’ HâŸ© = (Î»x. x?H)
    âŸ¨A â‡’ â˜…âŸ© = (Î»x. (âŸ¨A â‡’ GâŸ© x) !G)    (A not ground, not poly)
    âŸ¨â˜… â‡’ BâŸ© = (Î»x. âŸ¨H â‡’ BâŸ© (x ?H))    (B not ground, not poly)
	âŸ¨Aâ†’B â‡’ Aâ€²â†’Bâ€²âŸ© = (Î»f.Î»x. âŸ¨B â‡’ Bâ€²âŸ© (f (âŸ¨Aâ€² â‡’ AâŸ© x))    (f:Aâ†’B, x:Aâ€²)
	âŸ¨âˆ€X.A â‡’ âˆ€X.BâŸ© = Î»p. Î›X. Î½Î±=X. âŸ¨A[Î±/X] â‡’ B[Î±/X]âŸ© p[Î±] (p:âˆ€X.A)
	
    âŸ¨âˆ€X.A â‡’ BâŸ© = Î»p. âŸ¨A[â˜…/X] â‡’ BâŸ© p[â˜…]
	âŸ¨A â‡’ âˆ€Y.BâŸ© = 


Compilation of Terms to Cast Calculus

    ------------------
    | Î“ âŠ¢ M â† Mâ€² : A |
    ------------------

    x:A âˆˆ Î“
    --------------
    Î“ âŠ¢ x â† x : A

    Î“, x:A âŠ¢ N â† Nâ€² : B
    ---------------------------
    Î“ âŠ¢ Î»x:A.N â† Î»x.Nâ€² : A â†’ B

    Î“ âŠ¢ L â† Lâ€² : A â†’ B    Î“ âŠ¢ M â† Mâ€² : Aâ€²   Aâ€² ~ A
    -----------------------------------------------
    Î“ âŠ¢ L M â† Lâ€² MâŸ¨Aâ€²â‡’AâŸ© : B

    Î“ âŠ¢ L â† Lâ€² : â˜…   Î“ âŠ¢ M â† Mâ€² : Aâ€²
    -----------------------------------
    Î“ âŠ¢ L M â† Lâ€²âŸ¨â˜…â‡’â˜…â†’â˜…âŸ© Mâ€²âŸ¨Aâ€²â‡’â˜…âŸ© : â˜…

    Î“, X âŠ¢ V â† Vâ€² : B
    ------------------------
    Î“ âŠ¢ Î›X.V â† Î›X.Vâ€² : âˆ€X.B

    Î“ âŠ¢ L â† Lâ€² : âˆ€X.B    Î“ âŠ¢ A
    ---------------------------
    Î“ âŠ¢ L[A] â† Lâ€²[A] : B[A/X]

    Î“ âŠ¢ L â† Lâ€² : â˜…    Î“ âŠ¢ A
    ------------------------------
    Î“ âŠ¢ L[A] â† Lâ€²âŸ¨â˜…â‡’âˆ€X.â˜…âŸ©[A] : â˜…
   
